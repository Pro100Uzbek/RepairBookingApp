<!DOCTYPE html>
<html lang="ru">
<head>
    <script>
    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ—à–∏–±–æ–∫ –æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
    (function() {
        const originalErrorHandler = window.onerror;
        window.onerror = function(msg, url, line, col, error) {
            // –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
            if (url && url.includes('chrome-extension://')) {
                console.warn('–ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:', msg);
                return true; // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
            }
            
            // –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –≤–∞—à–∏ –æ—à–∏–±–∫–∏
            if (originalErrorHandler) {
                return originalErrorHandler.call(this, msg, url, line, col, error);
            }
            return false;
        };
    })();

    // –¢–∞–∫–∂–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ console.error –æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
    const originalConsoleError = console.error;
    console.error = function(...args) {
        const stack = new Error().stack;
        if (stack && stack.includes('chrome-extension://')) {
            // –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å
            return;
        }
        originalConsoleError.apply(console, args);
    };
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:image" content="https://pro100uzbek.github.io/RepairBookingApp/assets/logos/logo-dobarservis.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <title>Repair Service Montenegro</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@24.5.0/build/css/intlTelInput.css">

</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header-nav">
            <!-- –õ–µ–≤—ã–π –±–ª–æ–∫ (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –º–µ–Ω—é) -->
            <div class="header-left"></div>
            
            <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–ª–æ–∫ —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º -->
            <div class="header-center">
                <img src="assets/logos/dobarservis.png" alt="DOBAR SERVIS" class="header-logo">
            </div>
            
            <!-- –ü—Ä–∞–≤—ã–π –±–ª–æ–∫ —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º —è–∑—ã–∫–æ–≤ -->
            <div class="lang-switch">
                <button id="lang-ru" onclick="changeLang('ru')" class="btn active">RU</button>
                <button id="lang-cnr" onclick="changeLang('cnr')" class="btn">ME</button>
                <button id="lang-en" onclick="changeLang('en')" class="btn">EN</button>
            </div>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="main-title-container">
            <h1 id="title" class="hero-title">–ó–∞–ø–∏—Å—å –Ω–∞ —Ä–µ–º–æ–Ω—Ç</h1>
        </div>

        <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è -->
        <input type="hidden" id="lat" name="lat" value="">
        <input type="hidden" id="lng" name="lng" value="">
        <input type="hidden" id="source" name="source" value="direct">
        <input type="hidden" id="user_id" name="user_id" value="">

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ -->
        <form id="orderForm">
            <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä—è–¥ –¥–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->
            <div class="compact-row">
                <div class="form-group">
                    <input type="text" id="name" name="name" class="form-control" placeholder="–ò–º—è" required>
                </div>
                <div class="form-group">
                    <input type="tel" id="phone" name="phone" class="form-control" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required>
                    <div id="phone-error" class="validation-error" style="display: none;"></div>
                </div>
            </div>

            <!-- –ì–æ—Ä–æ–¥ (–æ–¥–∏–Ω–æ—á–Ω–æ–µ –ø–æ–ª–µ) -->
            <div class="form-group">
                <select id="city" name="city" class="form-control" onchange="handleCityChange(this.value)" required>
                    <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                    <option value="Podgorica">Podgorica</option>
                    <option value="Budva">Budva</option>
                    <option value="Bar">Bar</option>
                    <option value="Tivat">Tivat</option>
                    <option value="Kotor">Kotor</option>
                    <option value="Herceg Novi">Herceg Novi</option>
                </select>
            </div>

            <!-- –ê–¥—Ä–µ—Å (–ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞) -->
            <div id="address-section" style="display: none;">
                <div class="form-group" style="margin-bottom: var(--space-sm);">
                    <select id="address-type-select" class="form-control" onchange="handleAddressSelection(this.value, document.getElementById('city').value)">
                        <option value="" disabled selected data-i18n="address.optChooseAddress">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–±...</option>
                        <option value="map" data-i18n="address.optMapSelect">üìç –£–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ</option>
                        <option value="manual" data-i18n="address.optManualEntry">‚å®Ô∏è –í–≤–µ—Å—Ç–∏ –∞–¥—Ä–µ—Å/–æ—Ä–∏–µ–Ω—Ç–∏—Ä</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="text" id="address-input" name="address" class="form-control" placeholder="–ê–¥—Ä–µ—Å –∏–ª–∏ –æ—Ä–∏–µ–Ω—Ç–∏—Ä..."
                    data-required="true"> <!-- –ó–∞–º–µ–Ω—è–µ–º required –Ω–∞ data-required -->
                </div>
            </div>

            <!-- –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ -->
            <!-- –ü–æ–ª–µ –±—Ä–µ–Ω–¥–∞ —Å –∫–Ω–æ–ø–∫–æ–π -->
            <div class="form-group">
                <div class="brand-input-wrapper">
                    <input type="text" id="brand-input" class="form-control" 
                        placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –±—Ä–µ–Ω–¥" readonly 
                        style="border-right: none; border-radius: var(--radius-md) 0 0 var(--radius-md); cursor: pointer;"
                        onclick="openBrandModal()"> <!-- –î–æ–±–∞–≤–ª—è–µ–º onclick -->
                    <button type="button" class="brand-select-btn" onclick="openBrandModal()">
                        <span class="material-symbols-outlined">expand_more</span>
                    </button>
                </div>
                <input type="hidden" id="brand" name="brand" required>
            </div>

            <div class="compact-row">
                <div class="form-group">
                    <select id="type-category" name="category" class="form-control" required onchange="CategoryManager.updateSubMenu()">
                    </select>
                </div>
                
                <div class="form-group" id="type-subcategory" style="display: none;">
                    <select id="subcategory-select" name="subcategory" class="form-control">
                    </select>
                </div>
            </div>

            <!-- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã -->
            <div class="form-group">
                <textarea id="description" name="description" class="form-control" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã"></textarea>
            </div>

            <!-- –§–æ—Ç–æ -->
            <div class="form-group">
                <label for="photo" class="custom-file-upload">
                    <span class="material-symbols-outlined">photo_camera</span>
                    <span id="lbl-photo-btn">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ (–¥–æ 3-—Ö)</span>
                </label>
                <input type="file" id="photo" name="photo" accept="image/*,video/*" multiple onchange="FileManager.handleFiles(this)" style="display: none;">
                <div id="preview-container" class="preview-grid" style="margin-top: var(--space-sm);"></div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
            <button type="submit" id="btn-submit" class="btn btn-primary">–í—ã–∑–≤–∞—Ç—å –º–∞—Å—Ç–µ—Ä–∞</button>
        </form>

        <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
        <!-- –ú–æ–¥–∞–ª–∫–∞ –∫–∞—Ä—Ç—ã -->
        <div id="mapModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="map-modal-title" class="modal-title">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h3>
                    <button type="button" class="modal-close" onclick="closeMapModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="text" id="map-search-input" class="form-control" placeholder="–ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞...">
                    <div id="map-canvas-container">
                         <div id="map-canvas" style="width:100%; height:400px;"></div>
                    </div>
                    <div id="location-comparison"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="confirmLocation()" id="confirm-location-btn"
                    disabled>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∞–¥—Ä–µ—Å</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª–∫–∞ –±—Ä–µ–Ω–¥–æ–≤ -->
        <div id="brandModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="brand-modal-title" class="modal-title">–í—ã–±–µ—Ä–∏—Ç–µ –±—Ä–µ–Ω–¥</h3>
                    <button type="button" class="modal-close" onclick="closeBrandModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- –°–µ—Ç–∫–∞ –±—Ä–µ–Ω–¥–æ–≤ 3x3 -->
                    <div class="brand-selector-grid" id="brandSelectorGrid"></div>
                    
                    <!-- –ü–æ–ª–µ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ -->
                    <div class="manual-brand-input" style="margin-top: var(--space-lg);">
                        <div class="input-with-button">
                            <input type="text" id="customBrand" class="form-control" 
                                placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–µ–Ω–¥" 
                                style="height: 38px; font-size: 14px;">
                            <button type="button" class="btn btn-primary" onclick="applyCustomBrand()" 
                                    style="height: 38px; min-width: 60px; font-size: 14px;">
                                –û–ö
                            </button>
                        </div>
                        <div style="font-size: 11px; color: var(--text-tertiary); text-align: center; margin-top: 4px;">
                            –ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeBrandModal()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-title" class="modal-title">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ</h3>
                    <button type="button" class="modal-close" onclick="FormHandler.closeModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="summary"></div>
                    
                    <!-- –°—Ç–∞—Ç—É—Å–±–∞—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
                    <div id="upload-status" style="display: none; margin-top: var(--space-lg);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-sm);">
                            <span id="upload-status-text">–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
                            <span id="upload-percentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div id="upload-progress" class="progress-fill"></div>
                        </div>
                        <div id="upload-log" style="margin-top: var(--space-sm); font-size: 12px; color: var(--text-tertiary); max-height: 100px; overflow-y: auto;"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="FormHandler.closeModal()">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                    <button type="button" class="btn btn-primary" id="confirm-send-btn">–í—Å—ë –≤–µ—Ä–Ω–æ</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ -->
        <div id="statusModal" class="modal">
            <div class="modal-content" style="text-align: center;">
                <div style="font-size: 60px; color: var(--success-color); margin-bottom: var(--space-lg);">‚úì</div>
                <h3 id="status-title" class="modal-title">–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h3>
                <div class="modal-body">
                    <div id="status-details"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="FormHandler.closeStatusModal()">–ü–æ–Ω—è—Ç–Ω–æ</button>
                </div>
            </div>
        </div>

        <!-- –õ–æ–∞–¥–µ—Ä -->
        <div id="loader" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="loader">
                    <p>–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –í–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBU110F26z6_6y_lrJ4mjtcbt64gvorbmo&libraries=places,geometry&loading=async&callback=initMap"></script>
    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@24.5.0/build/js/intlTelInput.min.js"></script>

    <!-- –õ–æ–∫–∞–ª—å–Ω—ã–µ JS —Ñ–∞–π–ª—ã —Å –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ú –ø–æ—Ä—è–¥–∫–æ–º –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <!-- 1. –ë–∞–∑–æ–≤—ã–µ –º–æ–¥—É–ª–∏ –∏ –ø–µ—Ä–µ–≤–æ–¥—ã -->
    <script src="js/translations.js"></script>

    <!-- 2. CSS Handler (—É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∏–ª—è–º–∏) -->
    <script src="js/css-handler.js"></script>

    <!-- 3. –í–∞–ª–∏–¥–∞—Ü–∏—è -->
    <script src="js/validation.js"></script>

    <!-- 4. –ú–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script src="js/categories-handler.js"></script>
    <script src="js/file-handler.js"></script>
    <script src="js/maps-handler.js"></script>
    <script src="js/form-handler.js"></script>

    <!-- 5. –§—É–Ω–∫—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ -->
    <script src="js/script.js"></script>

    <!-- 6. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ—Å–ª–µ–¥–Ω—è—è) -->
    <script src="js/app.js"></script>

    <script>
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞
    window.addEventListener('load', function() {
        console.log('=== –°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´ ===');
        console.log('1. Telegram WebApp:', window.Telegram && window.Telegram.WebApp ? '‚úÖ' : '‚ùå');
        console.log('2. intlTelInput:', typeof intlTelInput !== 'undefined' ? '‚úÖ' : '‚ùå');
        console.log('3. window.iti:', window.iti ? '‚úÖ' : '‚ùå');
        console.log('4. ValidationManager:', typeof ValidationManager !== 'undefined' ? '‚úÖ' : '‚ùå');
        console.log('5. Google Maps:', typeof google !== 'undefined' ? '‚úÖ' : '‚ùå');
        console.log('6. Current Lang:', window.currentLang || '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const checkElements = [
            'orderForm', 'phone', 'name', 'brand', 
            'type-category', 'city', 'address-input'
        ];
        
        checkElements.forEach(id => {
            const el = document.getElementById(id);
            console.log(`${id}:`, el ? '‚úÖ' : '‚ùå');
        });
    });
    </script>
    <script src="js/debug.js"></script>
    <script src="js/event-protection.js"></script>
</body>

</html>

